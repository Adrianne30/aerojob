{"ast":null,"code":"import _objectSpread from\"/Users/macbookair/Desktop/AeroJobs/AeroJob/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/contexts/AuthContext.js\nimport React,{createContext,useContext,useEffect,useReducer}from'react';import{authAPI,setAuthToken}from'../utils/api';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const ACTIONS={SET_LOADING:'SET_LOADING',LOGIN_SUCCESS:'LOGIN_SUCCESS',LOGOUT:'LOGOUT',UPDATE_USER:'UPDATE_USER',SET_ERROR:'SET_ERROR'};const initial={user:null,token:null,isAuthenticated:false,loading:true,error:null};function reducer(state,action){switch(action.type){case ACTIONS.SET_LOADING:return _objectSpread(_objectSpread({},state),{},{loading:action.payload});case ACTIONS.LOGIN_SUCCESS:return _objectSpread(_objectSpread({},state),{},{user:action.payload.user,token:action.payload.token,isAuthenticated:true,loading:false,error:null});case ACTIONS.UPDATE_USER:return _objectSpread(_objectSpread({},state),{},{user:action.payload});case ACTIONS.LOGOUT:return _objectSpread(_objectSpread({},initial),{},{loading:false});case ACTIONS.SET_ERROR:return _objectSpread(_objectSpread({},state),{},{error:action.payload,loading:false});default:return state;}}function normalizeError(err){var _err$response,_err$response$data;let fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'Something went wrong';if(err!==null&&err!==void 0&&(_err$response=err.response)!==null&&_err$response!==void 0&&(_err$response$data=_err$response.data)!==null&&_err$response$data!==void 0&&_err$response$data.message)return err.response.data.message;if(err!==null&&err!==void 0&&err.message)return err.message;return fallback;}const getRoleFromUser=u=>(u===null||u===void 0?void 0:u.role)||(u===null||u===void 0?void 0:u.userType)||(u===null||u===void 0?void 0:u.type)||null;export function AuthProvider(_ref){let{children}=_ref;const[state,dispatch]=useReducer(reducer,initial);useEffect(()=>{const token=localStorage.getItem('token');if(!token){dispatch({type:ACTIONS.SET_LOADING,payload:false});return;}// Set auth header globally\nsetAuthToken(token);// Try fetching current user\nauthAPI.me().then(user=>{dispatch({type:ACTIONS.LOGIN_SUCCESS,payload:{user,token}});}).catch(err=>{console.warn('[AuthContext] /auth/me failed, clearing token',err);localStorage.removeItem('token');setAuthToken(null);dispatch({type:ACTIONS.SET_LOADING,payload:false});});},[]);async function login(_ref2){let{email,password}=_ref2;dispatch({type:ACTIONS.SET_LOADING,payload:true});try{const{user,token}=await authAPI.login({email,password});// Save to localStorage\nlocalStorage.setItem('token',token);// Attach to axios globally\nsetAuthToken(token);dispatch({type:ACTIONS.LOGIN_SUCCESS,payload:{user,token}});toast.success('Logged in successfully');return{success:true,user};}catch(err){const msg=normalizeError(err,'Login failed');dispatch({type:ACTIONS.SET_ERROR,payload:msg});toast.error(msg);return{success:false,error:msg};}}function logout(){let showToast=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;localStorage.removeItem('token');setAuthToken(null);dispatch({type:ACTIONS.LOGOUT});if(showToast)toast('Logged out');}async function refreshMe(){try{const user=await authAPI.me();dispatch({type:ACTIONS.UPDATE_USER,payload:user});return user;}catch(_unused){return null;}}function updateUser(patchOrFn){const next=typeof patchOrFn==='function'?patchOrFn(state.user):_objectSpread(_objectSpread({},state.user||{}),patchOrFn||{});dispatch({type:ACTIONS.UPDATE_USER,payload:next});return next;}// Role helpers\nconst role=getRoleFromUser(state.user);const hasRole=function(){for(var _len=arguments.length,roles=new Array(_len),_key=0;_key<_len;_key++){roles[_key]=arguments[_key];}return roles.includes(role);};const isAdmin=()=>role==='admin';const isStudentOrAlumni=()=>role==='student'||role==='alumni';const value=_objectSpread(_objectSpread({},state),{},{login,logout,refreshMe,updateUser,role,hasRole,isAdmin,isStudentOrAlumni});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}export function useAuth(){const ctx=useContext(AuthContext);if(!ctx)throw new Error('useAuth must be used within an AuthProvider');return ctx;}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useReducer","authAPI","setAuthToken","toast","jsx","_jsx","AuthContext","ACTIONS","SET_LOADING","LOGIN_SUCCESS","LOGOUT","UPDATE_USER","SET_ERROR","initial","user","token","isAuthenticated","loading","error","reducer","state","action","type","_objectSpread","payload","normalizeError","err","_err$response","_err$response$data","fallback","arguments","length","undefined","response","data","message","getRoleFromUser","u","role","userType","AuthProvider","_ref","children","dispatch","localStorage","getItem","me","then","catch","console","warn","removeItem","login","_ref2","email","password","setItem","success","msg","logout","showToast","refreshMe","_unused","updateUser","patchOrFn","next","hasRole","_len","roles","Array","_key","includes","isAdmin","isStudentOrAlumni","value","Provider","useAuth","ctx","Error"],"sources":["/Users/macbookair/Desktop/AeroJobs/AeroJob/frontend/src/contexts/AuthContext.js"],"sourcesContent":["// src/contexts/AuthContext.js\r\nimport React, { createContext, useContext, useEffect, useReducer } from 'react';\r\nimport { authAPI, setAuthToken } from '../utils/api';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst ACTIONS = {\r\n  SET_LOADING: 'SET_LOADING',\r\n  LOGIN_SUCCESS: 'LOGIN_SUCCESS',\r\n  LOGOUT: 'LOGOUT',\r\n  UPDATE_USER: 'UPDATE_USER',\r\n  SET_ERROR: 'SET_ERROR',\r\n};\r\n\r\nconst initial = {\r\n  user: null,\r\n  token: null,\r\n  isAuthenticated: false,\r\n  loading: true,\r\n  error: null,\r\n};\r\n\r\nfunction reducer(state, action) {\r\n  switch (action.type) {\r\n    case ACTIONS.SET_LOADING:\r\n      return { ...state, loading: action.payload };\r\n    case ACTIONS.LOGIN_SUCCESS:\r\n      return {\r\n        ...state,\r\n        user: action.payload.user,\r\n        token: action.payload.token,\r\n        isAuthenticated: true,\r\n        loading: false,\r\n        error: null,\r\n      };\r\n    case ACTIONS.UPDATE_USER:\r\n      return { ...state, user: action.payload };\r\n    case ACTIONS.LOGOUT:\r\n      return { ...initial, loading: false };\r\n    case ACTIONS.SET_ERROR:\r\n      return { ...state, error: action.payload, loading: false };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction normalizeError(err, fallback = 'Something went wrong') {\r\n  if (err?.response?.data?.message) return err.response.data.message;\r\n  if (err?.message) return err.message;\r\n  return fallback;\r\n}\r\n\r\nconst getRoleFromUser = (u) => u?.role || u?.userType || u?.type || null;\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(reducer, initial);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      dispatch({ type: ACTIONS.SET_LOADING, payload: false });\r\n      return;\r\n    }\r\n\r\n    // Set auth header globally\r\n    setAuthToken(token);\r\n\r\n    // Try fetching current user\r\n    authAPI\r\n      .me()\r\n      .then((user) => {\r\n        dispatch({ type: ACTIONS.LOGIN_SUCCESS, payload: { user, token } });\r\n      })\r\n      .catch((err) => {\r\n        console.warn('[AuthContext] /auth/me failed, clearing token', err);\r\n        localStorage.removeItem('token');\r\n        setAuthToken(null);\r\n        dispatch({ type: ACTIONS.SET_LOADING, payload: false });\r\n      });\r\n  }, []);\r\n\r\n  async function login({ email, password }) {\r\n    dispatch({ type: ACTIONS.SET_LOADING, payload: true });\r\n    try {\r\n      const { user, token } = await authAPI.login({ email, password });\r\n\r\n      // Save to localStorage\r\n      localStorage.setItem('token', token);\r\n\r\n      // Attach to axios globally\r\n      setAuthToken(token);\r\n\r\n      dispatch({ type: ACTIONS.LOGIN_SUCCESS, payload: { user, token } });\r\n      toast.success('Logged in successfully');\r\n      return { success: true, user };\r\n    } catch (err) {\r\n      const msg = normalizeError(err, 'Login failed');\r\n      dispatch({ type: ACTIONS.SET_ERROR, payload: msg });\r\n      toast.error(msg);\r\n      return { success: false, error: msg };\r\n    }\r\n  }\r\n\r\n  function logout(showToast = true) {\r\n    localStorage.removeItem('token');\r\n    setAuthToken(null);\r\n    dispatch({ type: ACTIONS.LOGOUT });\r\n    if (showToast) toast('Logged out');\r\n  }\r\n\r\n  async function refreshMe() {\r\n    try {\r\n      const user = await authAPI.me();\r\n      dispatch({ type: ACTIONS.UPDATE_USER, payload: user });\r\n      return user;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  function updateUser(patchOrFn) {\r\n    const next =\r\n      typeof patchOrFn === 'function'\r\n        ? patchOrFn(state.user)\r\n        : { ...(state.user || {}), ...(patchOrFn || {}) };\r\n    dispatch({ type: ACTIONS.UPDATE_USER, payload: next });\r\n    return next;\r\n  }\r\n\r\n  // Role helpers\r\n  const role = getRoleFromUser(state.user);\r\n  const hasRole = (...roles) => roles.includes(role);\r\n  const isAdmin = () => role === 'admin';\r\n  const isStudentOrAlumni = () => role === 'student' || role === 'alumni';\r\n\r\n  const value = {\r\n    ...state,\r\n    login,\r\n    logout,\r\n    refreshMe,\r\n    updateUser,\r\n    role,\r\n    hasRole,\r\n    isAdmin,\r\n    isStudentOrAlumni,\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error('useAuth must be used within an AuthProvider');\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}